version: 2.1

orbs:
  maven: circleci/maven@0.0.12

#workflows:
#  maven_test:
#    jobs:
#      - maven/test # checkout, build, test, and upload test results

jobs:
  first-mvn-job-to-execute-tests:
    docker:
      - image: circleci/openjdk:8u171-jdk
    steps:
      - checkout
      #- run: 'echo Running test'
      - run:
         command: |
            echo technotrainer Running test
            mvn clean test
      - store_test_results:
          path: /home/circleci/project/target/site/jacoco
          
  first-mvn-job-to-create-package:
    docker:
      - image: circleci/openjdk:8u171-jdk
    steps:
      - checkout
      #- run: 'echo Running test'
      - run:
         command: |
            echo technotrainer Running test
            mvn clean package
      - store_artifacts:
          path: /home/circleci/project/target/
          destination: mvn-artifact


workflows:
  # Name the workflow "welcome"
  first-workflow-maven:
    # Run the welcome/run job in its own container
    jobs:
      - first-mvn-job-to-execute-tests
      - first-mvn-job-to-create-package:
          requires:
            - first-mvn-job-to-execute-tests